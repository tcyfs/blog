<ul id="pl" class="comments">
    {% for comment in comments %}
    <li class="comment">
        <div class="comment-thumbnail">
            <a href="{{ url_for('.user', username=comment.author.username) }}">
            {% if comment.author.photo %}
                <img class="img-rounded profile-thumbnail" src="{{ comment.author.photo}}" style="height: 40px; width: 40px">
            {% else %}
                <img class="img-rounded profile-thumbnail" src="{{ comment.author.gravatar(size=40)}}">
            {% endif %}
            </a>
        </div>
        <div  class="comment-content">
            <div class="comment-date">{{ moment(comment.timestamp).fromNow() }}</div>
            <div class="comment-author"><a href="{{ url_for('.user', username=comment.author.username) }}">{{ comment.author.username }}</a></div>
            <div class="comment-body" style="overflow-wrap: break-word;">
                {% if comment.disabled %}
                {% if current_user == comment.author or current_user.is_administrator() %}
                <p style="color: red"><i>系统提示：这条评论已被屏蔽,仅本人和管理员可见</i></p>
                {% if comment.body_html %}
                {{ comment.body_html | safe }}
                {% else %}
                {{ comment.body }}
                {% endif %}
                {% else %}
                <p style="color: red"><i>系统提示：这条评论已被屏蔽</i></p>
                {% endif %}
                {% else %}
                {% if comment.body_html %}
                {{ comment.body_html | safe }}
                {% else %}
                {{ comment.body }}
                {% endif %}
               
                {% endif %}
                
            </div>
            <div id="comment_bar{{comment.id}}" style="padding-bottom: 20px ">
            
            {% if not comment.disabled %}
            {% if current_user.can(Permission.COMMENT) %}
                <script>
                
                $(document).ready(function(){
                $("#recomment{{ comment.id }}").click(function(){
                $("#rawcomment{{ comment.id }}").toggle();
                });
                });
                </script>


            <a href="javascript:void(0)" id="recomment{{ comment.id}}" style="color:black; padding-left: 8px; float: right">回复</a>
            {% if current_user == comment.author or current_user.is_administrator() %}
            <script type="text/javascript">
                $("#comment_bar{{comment.id}}").hover(function(){
                $("#delcomment{{comment.id}}").css("visibility","visible");
              },function(){
                $("#delcomment{{comment.id}}").css("visibility","hidden");
              });
            </script>
            <a id="delcomment{{comment.id}}" href="{{ url_for('.delete_comment', id=comment.id) }}" style="color: #e14d4d; float: right; visibility: hidden;" >删除</a>
            {% endif %}      
            <div id="rawcomment{{ comment.id}}" style="display: none;">
            <script type="text/javascript">
            var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
            $(function(){
                $("#calculate{{ comment.id }}").click(function(){
                    var a=$('textarea[name="a{{comment.id}}"]').val();
                    var data={
                        data: JSON.stringify({
                            'a': a
                        }),
                    }
                    $.ajax({
                        url: $SCRIPT_ROOT + '/recomment/'+{{comment.id}},
                        type: 'POST',
                        dataType: 'json',
                        data: data,
                        success:function(data){
                            $('textarea[name="a{{comment.id}}"]').val("");
                            $("#rawcomment{{ comment.id }}").toggle();
                            
                            $.ajax({
                                url:$SCRIPT_ROOT + '/post/'+{{comment.post_id}},
                                dataType: 'html',
                                success:function(data){
                                    $("#repl{{comment.id}}").prepend('<li id="re{{comment.id}}" class="recomment"  style="list-style-type:none;">'+$(data).find('#re{{comment.id}}').html()+'</li>');
                                    
                                }
                            })
                            
                        },
                        error:function(){
                            alert('回复内容不能为空')
                            
                        }
                    })
                })
            })
            </script>
<p>
  <textarea id="b{{comment.id}}" type="text" style="width: 98%;border-width: 1px; border-style:solid;border-color:#e4dcdc;overflow-wrap: break-word;overflow: hidden;resize:none; height: 24px " onfocus="window.activeobj=this;this.clock=setInterval(function(){activeobj.style.height=activeobj.scrollHeight+'px';},200);" onblur="clearInterval(this.clock);" name="a{{comment.id}}"></textarea>
</p>
<button id="calculate{{ comment.id }}">回复</button>
</div>




            </div>
            {% endif %}
            {% endif %}
            {% include '_recomments.html' %}
            
        </div>

    </li>
    {% endfor %}
</ul>


